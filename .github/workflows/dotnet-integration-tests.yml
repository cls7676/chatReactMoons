#
# This workflow will run all integrations tests.
#

name: dotnet-integration-tests

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
    paths:
      - "dotnet/**"

permissions:
  contents: read

jobs:
  integration-tests:
    strategy:
        matrix:
          os: [ubuntu-latest]
          configuration: [Debug]
    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v3
      with:
        clean: true

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x

    - name: Find projects
      shell: bash
      run: echo "projects=$(find ./dotnet -type f -name "*.IntegrationTests.csproj" | tr '\n' ' ')" >> $GITHUB_ENV

    - name: Integration Tests
      shell: bash
      env: # Set Azure credentials secret as an input
        AzureOpenAI__Label: azure-text-davinci-003
        AzureOpenAIEmbedding__Label: azure-text-embedding-ada-002
      